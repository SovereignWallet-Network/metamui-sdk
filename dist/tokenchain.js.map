{"version":3,"sources":["../src/tokenchain.ts"],"names":[],"mappings":"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","file":"tokenchain.js","sourcesContent":["import { buildConnection } from './connection';\nimport { ApiPromise } from '@polkadot/api';\nimport { submitTransaction } from './common/helper';\nimport { KeyringPair } from '@polkadot/keyring/types';\nimport { hexToString } from '@polkadot/util';\nimport { HexString } from '@polkadot/util/types';\nimport { utils } from '.';\nimport { sanitiseCCode } from './token';\nimport { getVCs } from './vc';\n\n/**\n * get Token List\n * @param {ApiPromise} api\n * @returns {Object} Token List\n */\n async function getTokenList(api: ApiPromise) {\n    const provider = api || (await buildConnection('local'));\n    const paraIds: any = (await provider.query.paras.parachains());\n    let tokenList = [];\n    for (let i = 0; i < paraIds.length; i++) {\n        let tokenInfo = String(await provider.query.tokenchain.rLookup(paraIds[i]));\n        tokenList.push({\n            id: paraIds[i].toString(),\n            name: utils.tidy(hexToString(tokenInfo)),\n        });\n    }\n    tokenList.push({ id: null, name: 'MUI' });\n    tokenList.sort((a, b) => a.name > b.name ? 1 : -1);\n    return tokenList;\n}\n\n/**\n * Lookup Tokenchain with Token Name to get ParaId\n * @param {HexString|String} tokenName\n * @param {ApiPromise} api\n * @returns {Number} Para Id\n */\n async function lookup(tokenName: HexString|String, api: ApiPromise) {\n    const provider = api || (await buildConnection('local'));\n    const paraId = (await provider.query.tokenchain.lookup(sanitiseCCode(tokenName))).toString();\n    return parseInt(paraId, 10);\n}\n\n/**\n * Reverse Lookup Tokenchain with ParaId to get Token Name\n * @param {Number} paraId\n * @param {ApiPromise} api\n * @returns {String} Token Name\n */\nasync function lookUpParaId(paraId: Number, api: ApiPromise): Promise<string> {\n    const provider = api || (await buildConnection('local'));\n    return utils.tidy(hexToString((await provider.query.tokenchain.rLookup(paraId)).toString())).toUpperCase();\n}\n\n\n/**\n * Get Token Issuer by currency code\n * @param {String} currencyCode\n * @param {ApiPromise} api\n * @returns {String} Token Isssuer Did\n */\n async function getTokenIssuer(currencyCode: String, api: ApiPromise): Promise<string> {\n    const provider = api || (await buildConnection('local'));\n    return (await provider.query.tokenchain.tokenIssuers(currencyCode)).toHex();\n}\n\n/**\n * Get Token Info by currency code\n * @param {String} currencyCode\n * @param {ApiPromise} api\n * @returns {Object} Token Details\n */\n async function getTokenInfo(currencyCode: String, api: ApiPromise): Promise<any> {\n    const provider = api || (await buildConnection('local'));\n    return (await provider.query.tokenchain.tokenInfo(currencyCode)).toJSON();\n}\n\n/**\n * Add new parachain (requires sudo)\n * @param {HexString} vcId Currency Code HexString\n * @param {number} initialIssuance LOWEST FORM\n * @param {KeyringPair} sudoAccountKeyPair\n * @param {ApiPromise} api\n */\nasync function initParachain(vcId: HexString, initialIssuance: number, sudoAccountKeyPair:KeyringPair, api: ApiPromise) {\n    const provider = api || (await buildConnection('local'));\n    const vc_check = await getVCs(vcId, provider);\n    if(vc_check == null)\n        throw new Error('VC does not exist');\n    if(initialIssuance < 1 || initialIssuance == null)\n        throw new Error('Initial Issuance must be greater than 0');\n    const tx = provider.tx.sudo.sudo(\n        provider.tx.tokenchain.initParachain(vcId, initialIssuance)\n    );\n    let nonce = await provider.rpc.system.accountNextIndex(sudoAccountKeyPair.address);\n    let signedTx = await tx.signAsync(sudoAccountKeyPair, { nonce });\n    return submitTransaction(signedTx, provider);\n}\n\n/**\n * Remove parachain (requires sudo)\n * @param {String} tokenName Currency Code HexString\n * @param {KeyringPair} sudoAccountKeyPair\n * @param {ApiPromise} api\n */\n async function removeParachain(tokenName: String, sudoAccountKeyPair:KeyringPair, api: ApiPromise) {\n    const provider = api || (await buildConnection('local'));\n    const tx = provider.tx.sudo.sudo(\n        provider.tx.tokenchain.removeParachain(sanitiseCCode(tokenName))\n    );\n    let nonce = await provider.rpc.system.accountNextIndex(sudoAccountKeyPair.address);\n    let signedTx = await tx.signAsync(sudoAccountKeyPair, { nonce });\n    return submitTransaction(signedTx, provider);\n}\n\nexport {\n    sanitiseCCode,\n    getTokenList,\n    lookup,\n    lookUpParaId,\n    initParachain,\n    removeParachain,\n    getTokenIssuer,\n    getTokenInfo,\n};\n"]}