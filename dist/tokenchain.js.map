{"version":3,"sources":["../src/tokenchain.ts"],"names":[],"mappings":"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","file":"tokenchain.js","sourcesContent":["import { buildConnection } from './connection';\nimport { ApiPromise } from '@polkadot/api';\nimport { submitTransaction } from './common/helper';\nimport { KeyringPair } from '@polkadot/keyring/types';\nimport { hexToString } from '@polkadot/util';\nimport { HexString } from '@polkadot/util/types';\nimport { utils } from '.';\nglobal.Buffer = require('buffer').Buffer;\n\n/**\n * Sanitise Token Name\n * @param {String} token\n * @returns {String} Sanitised Token Name\n */\nconst sanitiseToken = (token: String): String => {\n    if (token.startsWith('0x'))\n        return token.padEnd(16, '0');\n        \n    return '0x' + Buffer.from(token.toUpperCase(), 'utf8').toString('hex').padEnd(16, '0');\n}\n\n/**\n * get Token List\n * @param {ApiPromise} api\n * @returns {Object} Token List\n */\n async function getTokenList(api: ApiPromise) {\n    const provider = api || (await buildConnection('local'));\n    const paraIds: any = (await provider.query.paras.parachains());\n    let tokenList = [];\n    for (let i = 0; i < paraIds.length; i++) {\n        let tokenInfo = String(await provider.query.tokenchain.rLookup(paraIds[i]));\n        tokenList.push({\n            id: paraIds[i].toString(),\n            name: utils.tidy(hexToString(tokenInfo)),\n        });\n    }\n    tokenList.push({ id: null, name: 'MUI' });\n    tokenList.sort((a, b) => a.name > b.name ? 1 : -1);\n    return tokenList;\n}\n\n/**\n * Lookup Tokenchain with Token Name to get ParaId\n * @param {HexString|String} tokenName\n * @param {ApiPromise} api\n * @returns {Number} Para Id\n */\n async function lookupTokenchain(tokenName: HexString|String, api: ApiPromise) {\n    const provider = api || (await buildConnection('local'));\n    const paraId = (await provider.query.tokenchain.lookup(sanitiseToken(tokenName))).toString();\n    return parseInt(paraId, 10);\n}\n\n/**\n * Reverse Lookup Tokenchain with ParaId to get Token Name\n * @param {Number} paraId\n * @param {ApiPromise} api\n * @returns {String} Token Name\n */\nasync function reverseLookupTokenchain(paraId: Number, api: ApiPromise): Promise<string> {\n    const provider = api || (await buildConnection('local'));\n    return utils.tidy(hexToString((await provider.query.tokenchain.rLookup(paraId)).toString())).toUpperCase();\n}\n\n/**\n * Add new parachain (requires sudo)\n * @param {String} tokenName Currency Code HexString\n * @param {Number} paraId\n * @param {KeyringPair} sudoAccountKeyPair\n * @param {ApiPromise} api\n */\nasync function addParachain(tokenName: String, paraId: Number, sudoAccountKeyPair:KeyringPair, api: ApiPromise) {\n    const provider = api || (await buildConnection('local'));\n    const tx = provider.tx.sudo.sudo(\n        provider.tx.tokenchain.addParachain(paraId, sanitiseToken(tokenName))\n    );\n    let nonce = await provider.rpc.system.accountNextIndex(sudoAccountKeyPair.address);\n    let signedTx = await tx.signAsync(sudoAccountKeyPair, { nonce });\n    return submitTransaction(signedTx, provider);\n}\n\n/**\n * Remove parachain (requires sudo)\n * @param {String} tokenName Currency Code HexString\n * @param {KeyringPair} sudoAccountKeyPair\n * @param {ApiPromise} api\n */\n async function removeParachain(tokenName: String, sudoAccountKeyPair:KeyringPair, api: ApiPromise) {\n    const provider = api || (await buildConnection('local'));\n    const tx = provider.tx.sudo.sudo(\n        provider.tx.tokenchain.removeParachain(sanitiseToken(tokenName))\n    );\n    let nonce = await provider.rpc.system.accountNextIndex(sudoAccountKeyPair.address);\n    let signedTx = await tx.signAsync(sudoAccountKeyPair, { nonce });\n    return submitTransaction(signedTx, provider);\n}\n\nexport {\n    sanitiseToken,\n    getTokenList,\n    lookupTokenchain,\n    reverseLookupTokenchain,\n    addParachain,\n    removeParachain\n};\n"]}